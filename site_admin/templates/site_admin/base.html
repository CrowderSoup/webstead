{% load static %}
<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>{% block title %}Admin{% endblock %} Â· {{ settings.title }}</title>
    <link rel="icon" href="{% static 'site_admin/favicon.svg' %}" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <script src="https://cdn.tailwindcss.com?plugins=forms"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: {
              sans: ["Space Grotesk", "ui-sans-serif", "system-ui"],
            },
          },
        },
      };
    </script>
    <script>
      (function () {
        const storageKey = "admin-theme";
        const root = document.documentElement;
        const saved = localStorage.getItem(storageKey);
        const prefersDark = window.matchMedia("(prefers-color-scheme: dark)").matches;
        const isDark = saved ? saved === "dark" : prefersDark;
        root.classList.toggle("admin-theme-dark", isDark);
      })();
    </script>
    <style>
      :root {
        --admin-bg: #f6f2ec;
        --admin-surface: #ffffff;
        --admin-ink: #1b1b1b;
        --admin-muted: #6b6a69;
        --admin-accent: #0f766e;
        --admin-accent-strong: #0a5b55;
        --admin-border: #e5dfd6;
        --admin-warn: #b45309;
        --site-admin-bar-bg: var(--admin-bg);
        --site-admin-bar-hamburger-bg: var(--admin-surface);
      }

      .admin-theme-dark {
        color-scheme: dark;
        --admin-bg: #0f1214;
        --admin-surface: #171b20;
        --admin-ink: #f5f2ec;
        --admin-muted: #9aa1a8;
        --admin-accent: #2dd4bf;
        --admin-accent-strong: #14b8a6;
        --admin-border: #2a3138;
        --admin-warn: #fbbf24;
        --site-admin-bar-bg: var(--admin-bg);
        --site-admin-bar-hamburger-bg: var(--admin-surface);
      }

      .admin-theme-dark .site-admin-bar {
        --admin-muted: #9aa1a8;
        --admin-accent: #2dd4bf;
        --admin-accent-strong: #14b8a6;
        --admin-warn: #fbbf24;
        --admin-ink: #f5f2ec;
        --admin-surface: #171b20;
      }

      .admin-theme-dark .bg-white {
        background-color: var(--admin-surface) !important;
      }

      .admin-theme-dark input:not([type="checkbox"]):not([type="radio"]):not([type="range"]),
      .admin-theme-dark textarea,
      .admin-theme-dark select {
        background-color: var(--admin-surface);
        color: var(--admin-ink);
        border-color: var(--admin-border);
      }

      .admin-theme-dark input::placeholder,
      .admin-theme-dark textarea::placeholder {
        color: var(--admin-muted);
      }

      .errorlist {
        margin-top: 0.35rem;
        color: #b91c1c;
        font-size: 0.75rem;
        list-style: none;
        padding: 0;
      }

      .errorlist li {
        margin: 0;
      }
    </style>
    {% block head %}{% endblock %}
  </head>
  <body class="min-h-screen bg-[color:var(--admin-bg)] text-[color:var(--admin-ink)]">
    {% include "site_admin/_admin_bar.html" %}
    <main class="mx-auto max-w-6xl px-4 py-8">
      {% block content %}{% endblock %}
    </main>
    <script src="https://unpkg.com/htmx.org@1.9.12"></script>
    <script src="{% static 'js/admin_slugify.js' %}"></script>
    <script>
      function getCookie(name) {
        if (!document.cookie) {
          return null;
        }
        const csrfCookie = document.cookie
          .split(";")
          .map((cookie) => cookie.trim())
          .find((cookie) => cookie.startsWith(name + "="));
        if (!csrfCookie) {
          return null;
        }
        return decodeURIComponent(csrfCookie.split("=")[1]);
      }

      document.body.addEventListener("htmx:configRequest", (event) => {
        const token = getCookie("csrftoken");
        if (token) {
          event.detail.headers["X-CSRFToken"] = token;
        }
      });

      (function () {
        const storageKey = "admin-theme";
        const root = document.documentElement;
        const prefersDarkQuery = window.matchMedia("(prefers-color-scheme: dark)");
        const toggles = () =>
          Array.from(document.querySelectorAll("[data-admin-theme-toggle]"));

        function applyTheme(theme) {
          const isDark =
            theme === "dark" || (theme === "system" && prefersDarkQuery.matches);
          root.classList.toggle("admin-theme-dark", isDark);
          toggles().forEach((button) => {
            const next = isDark ? "Light mode" : "Dark mode";
            button.setAttribute("aria-label", next);
            button.setAttribute("title", next);
            button.setAttribute("aria-pressed", String(isDark));
          });
        }

        function getStoredTheme() {
          return localStorage.getItem(storageKey) || "system";
        }

        function setStoredTheme(theme) {
          localStorage.setItem(storageKey, theme);
        }

        function toggleTheme() {
          const current = getStoredTheme();
          const isDark =
            current === "dark" || (current === "system" && prefersDarkQuery.matches);
          const next = isDark ? "light" : "dark";
          setStoredTheme(next);
          applyTheme(next);
        }

        document.addEventListener("click", (event) => {
          const button = event.target.closest("[data-admin-theme-toggle]");
          if (!button) {
            return;
          }
          event.preventDefault();
          toggleTheme();
        });

        prefersDarkQuery.addEventListener("change", () => {
          if (getStoredTheme() === "system") {
            applyTheme("system");
          }
        });

        applyTheme(getStoredTheme());
      })();
    </script>
    {% block body_end %}{% endblock %}
  </body>
</html>
